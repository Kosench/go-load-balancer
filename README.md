# go-load-balancer

![Go Version](https://img.shields.io/badge/Go-1.24+-00ADD8?style=flat&logo=go)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

–ü—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π HTTP load balancer –Ω–∞ Go —Å round-robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ health checks –∏ –≥–∏–±–∫–∏–º rate limiting –Ω–∞ –æ—Å–Ω–æ–≤–µ API –∫–ª—é—á–µ–π.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ **Round-robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –±—ç–∫–µ–Ω–¥–∞–º–∏
- üíì **Health checks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–µ–Ω–¥–æ–≤
- üö¶ **Rate limiting** - –≥–∏–±–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –∫–ª—é—á–µ–π
- üîå **Graceful shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±—ç–∫–µ–Ω–¥–æ–≤
- üéõÔ∏è **REST API** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ HTTP endpoints
- üìä **Structured logging** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é zerolog
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24 –∏–ª–∏ –≤—ã—à–µ

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd go-load-balancer

# –°–∫–∞—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod download

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
cp app.env.example app.env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ app.env –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
go run cmd/loadbalancer/main.go
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `app.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `app.env.example` –∫–∞–∫ —à–∞–±–ª–æ–Ω):

```env
# –ê–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
LISTEN_ADDRESS=:8080

# –ë—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
BACKENDS=localhost:9001,localhost:9002,localhost:9003

# Rate limiting: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤
RATE_LIMIT_CAPACITY=5

# Rate limiting: —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
RATE_LIMIT_REFILL_RATE=1
```

–ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ —Ñ–∞–π–ª–∞.

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è API –∫–ª—é—á–∞:

```bash
curl -X POST http://localhost:8080/clients \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "user1",
    "capacity": 10,
    "rate_per_sec": 2,
    "api_key": "secret-key-123"
  }'
```

–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å `api_key`, –æ–Ω –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `client_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `capacity` - —Ä–∞–∑–º–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ (burst capacity)
- `rate_per_sec` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º—ã—Ö –≤ —Å–µ–∫—É–Ω–¥—É
- `api_key` - API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π API –∫–ª—é—á –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-API-Key`:

```bash
curl http://localhost:8080/ \
  -H "X-API-Key: secret-key-123"
```

–ó–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ–¥–∏–Ω –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–µ–Ω–¥–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ round-robin —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
curl http://localhost:8080/clients

# –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ ID
curl http://localhost:8080/clients/user1

# –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
curl -X PUT http://localhost:8080/clients/user1 \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "user1",
    "capacity": 20,
    "rate_per_sec": 5,
    "api_key": "secret-key-123"
  }'

# –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
curl -X DELETE http://localhost:8080/clients/user1
```

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ cmd/loadbalancer/     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ backend/          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ balancer/         # –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ client/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ API –∫–ª—é—á–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ health/           # Health check –º–µ—Ö–∞–Ω–∏–∑–º
‚îÇ   ‚îî‚îÄ‚îÄ server/           # HTTP —Å–µ—Ä–≤–µ—Ä –∏ middleware
‚îú‚îÄ‚îÄ app.env.example       # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ go.mod                # Go –º–æ–¥—É–ª–∏
‚îú‚îÄ‚îÄ go.sum
‚îî‚îÄ‚îÄ README.md
```

## üß™ –¢–µ—Å—Ç—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
go test ./...

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
go test ./... -cover

# –î–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
go test ./... -v
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:

```bash
# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
go vet ./...

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
go fmt ./...
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Load Balancer** –ø–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
2. **Rate Limiter** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç API –∫–ª—é—á –∏ –ª–∏–º–∏—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
3. **Balancer** –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±—ç–∫–µ–Ω–¥ (round-robin)
4. **Reverse Proxy** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥
5. **Health Checker** –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–æ–≤

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

## ü§ù –í–∫–ª–∞–¥

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É—á–µ–±–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!

